<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>配置系统</title>
</head>
<body>
<form id="dataConfig">
    <label for="dataConfigFNOSPort">
        FNNAS服务端口(HTTPS端口)：
    </label>
    <input type="number" id="dataConfigFNOSPort" name="dataConfigFNOSPort"/><br><br>
    <label for="dataConfigIp">
        frp服务器：
    </label>
    <input type="text" id="dataConfigIp" name="dataConfigIp"/><br><br>
    <label for="dataConfigName">
        frp服务名称：
    </label>
    <input type="text" id="dataConfigName" name="dataConfigName"/><br><br>
    <label for="dataConfigSecretKey">
        frp服务密钥：
    </label>
    <input type="text" id="dataConfigSecretKey" name="dataConfigSecretKey"/><br><br>
    <label for="dataConfigPort">
        frp服务端口：
    </label>
    <input type="text" id="dataConfigPort" name="dataConfigPort"/><br><br>
</form>
<button type="button" onclick="saveConfig()">
保存
</button>
<script>
    function saveConfig() {
        const configData = {
            ip: document.getElementById("dataConfigIp").value,
            name: document.getElementById("dataConfigName").value,
            secretKey: document.getElementById("dataConfigSecretKey").value,
            port: document.getElementById("dataConfigPort").value,
            FNOSPort: document.getElementById("dataConfigFNOSPort").value,
        }
        try{
            const copyConfig = `serverAddr = "${configData.ip}"
serverPort = ${configData.port}

[[proxies]]
name = "${configData.name}"
type = "xtcp"
# 只有共享密钥 (secretKey) 与服务器端一致的用户才能访问该服务
secretKey = "${configData.secretKey}"
localIP = "127.0.0.1"
localPort = ${configData.FNOSPort}
        `
            navigator.clipboard.writeText(copyConfig).then(() => {
                alert(`FNNAS配置已经成功写入剪切板，若未配置FNOS端，请前往配置！`)
                window.electronAPI.sendMessage('save-config',configData)
            })
        }catch (e) {
            alert(JSON.stringify(e.message))
        }
    }

    try{
        window.electronAPI.fs.readFile().then(res => {
            const data = JSON.parse(res)
            document.getElementById("dataConfigIp").value = data.ip
            document.getElementById("dataConfigName").value = data.name
            document.getElementById("dataConfigSecretKey").value = data.secretKey
            document.getElementById("dataConfigPort").value = data.port
            document.getElementById("dataConfigFNOSPort").value = data.FNOSPort
        });
    }catch (e) {
        alert(e.message)
    }
</script>
</body>
</html>